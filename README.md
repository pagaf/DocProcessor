# DocProcessor

## Описание

DocProcessor — это сервис для обработки обновлений документов, поступающих в произвольном порядке. Сервис обеспечивает корректное формирование итоговых документов с учетом их версий и обновлений.

## Основные функции

- Обработка документов, поступающих в произвольном порядке.
- Обработка дублирующихся сообщений.
- Формирование итоговых документов с исправленными полями по следующим правилам:
  - Поля `Text` и `FetchTime` должны быть такими, какими были в документе с наибольшим `FetchTime`.
  - Поле `PubDate` должно быть таким, каким было у сообщения с наименьшим `FetchTime`.
  - Поле `FirstFetchTime` должно быть равно минимальному значению `FetchTime`.
  
## Используемые технологии

- **Python**: Основной язык программирования для реализации сервиса.
- **SQLite**: Встроенная база данных для хранения документов и их версий.
- **unittest**: Библиотека для написания и выполнения модульных тестов.
- **protobuf**: Формат сериализации данных, используемый для определения структуры сообщения `TDocument`.
- **argparse**: Библиотека для обработки аргументов командной строки в CLI-версии.

## Структура данных

### Сообщение TDocument

```protobuf
message TDocument {
    string Url = 1;           // URL документа, его уникальный идентификатор
    uint64 PubDate = 2;       // время заявляемой публикации документа
    uint64 FetchTime = 3;     // время получения данного обновления документа, может рассматриваться как идентификатор версии
    string Text = 4;          // текст документа
    uint64 FirstFetchTime = 5; // изначально отсутствует, необходимо заполнить
}
```

## Пример

```python
from main import Processor, TDocument

# Инициализация процессора
processor = Processor("database.db")

# Обработка документа
doc = TDocument(url="http://example.com/doc1", pub_date=10, fetch_time=20, text="Первый вариант")
result = processor.process(doc)

print(result)
```

## CLI и пример взаимодействия 
Также в рамках задания был реализован CLI в cli.py
Пример взаимодействия(первый тест):
```
python main.py --db database.db "http://example.com/doc1" 10 20 "Первый вариант"
python main.py --db database.db "http://example.com/doc1" 10 30 "Второй вариант"
```

![image](https://github.com/pagaf/DocProcessor/assets/112046185/c45e5acf-8b78-4a9d-a141-9fa7b0faef60)

